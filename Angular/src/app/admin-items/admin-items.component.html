<main class="page-admin">
  <div class="outer-container">
    <div class="welcome-header">
      <h2 class="welcome-title">
        {{ ts.t('admin.itemsTitle') }}
        <button mat-mini-fab class="btn-add" [title]="ts.t('admin.addItem')" (click)="openCreate()">
          <mat-icon>add</mat-icon>
        </button>
      </h2>
      <p class="welcome-text">{{ ts.t('admin.itemsSubtitle') }}</p>
    </div>

    @if (loadError()) {
      <div class="admin-error">{{ loadError() }}</div>
    }

    @if (actionError()) {
      <div class="admin-error">{{ actionError() }}</div>
    }

    @if (isLoading()) {
      <div class="loading">
        <mat-spinner diameter="48"></mat-spinner>
      </div>
    }

    @if (!isLoading() && items().length === 0) {
      <div class="empty">{{ ts.t('admin.noItems') }}</div>
    }

    @if (!isLoading() && items().length > 0) {
      <div class="items-grid">
        @for (item of items(); track item.id) {
          <mat-card class="item-card" [class.archived]="item.deleted_at" [class.unavailable]="unavailableIds().has(item.id)">
            <div class="item-image">
              @if (item.image_url) {
                <img [src]="item.image_url" [alt]="item.name" />
              } @else {
                <div class="image-placeholder"></div>
              }
              @if (item.deleted_at) {
                <div class="archived-badge">{{ ts.t('admin.archived') }}</div>
              } @else if (unavailableIds().has(item.id)) {
                <div class="unavailable-badge">{{ ts.t('admin.unavailable') }}</div>
              }
            </div>
            <mat-card-content class="item-body">
              <mat-card-title class="item-name">{{ item.name }}</mat-card-title>
              <mat-card-subtitle class="item-description">{{ item.description }}</mat-card-subtitle>
              <span class="item-category">{{ item.category_name ?? 'â€”' }}</span>
              <span class="item-price">{{ item.price | number:'1.2-2' }} $</span>
            </mat-card-content>
            <mat-card-actions class="item-actions">
              @if (item.deleted_at) {
                <button mat-icon-button class="action-btn restore" [title]="ts.t('admin.restoreBtn')" (click)="confirmRestore(item)">
                  <mat-icon>unarchive</mat-icon>
                </button>
              } @else {
                <button mat-icon-button class="action-btn edit" [title]="ts.t('admin.editBtn')" (click)="openEdit(item)">
                  <mat-icon>edit</mat-icon>
                </button>
                <button mat-icon-button class="action-btn delete" [title]="ts.t('admin.deleteBtn')" (click)="confirmDelete(item)">
                  <mat-icon>delete</mat-icon>
                </button>
              }
            </mat-card-actions>
          </mat-card>
        }
      </div>
    }
  </div>
</main>

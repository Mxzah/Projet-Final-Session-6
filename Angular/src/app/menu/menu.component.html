<header class="site-header">
  <div class="brand">RestoQR</div>
  <div class="header-actions">
    <div class="cart-display">
      <span class="cart-icon">&#128722;</span>
      <span class="cart-total">Sous-total CA$0.00</span>
    </div>
    <button class="ghost" (click)="logout()">Déconnexion</button>
  </div>
</header>

<main class="menu-page">
  @if (isLoading()) {
    <div class="loading">
      <p>Chargement du menu...</p>
    </div>
  } @else if (errorMessage()) {
    <div class="error-banner">
      <p>{{ errorMessage() }}</p>
    </div>
  } @else {
    <div class="menu-layout">
      <aside class="sidebar">
        <h2 class="sidebar-title">Catégories</h2>
        <nav class="category-nav">
          @for (cat of categories(); track cat.id) {
            <button
              class="category-btn"
              [class.active]="cat.id === activeCategory()"
              (click)="selectCategory(cat.id)"
            >
              {{ cat.name }}
            </button>
          }
        </nav>
      </aside>

      <section class="menu-content">
        <div class="ssf-bar">
          <div class="ssf-search">
            <input
              type="text"
              placeholder="Rechercher un item..."
              (input)="onSearchInput($event)"
            />
          </div>
          <div class="ssf-sort">
            <select (change)="onSortChange($event)">
              <option value="none">Trier par prix</option>
              <option value="asc">Prix croissant</option>
              <option value="desc">Prix décroissant</option>
            </select>
          </div>
          <div class="ssf-filter">
            <input
              type="number"
              placeholder="Prix min"
              min="0"
              step="0.01"
              (input)="onPriceMinChange($event)"
            />
            <span class="ssf-separator">—</span>
            <input
              type="number"
              placeholder="Prix max"
              min="0"
              step="0.01"
              (input)="onPriceMaxChange($event)"
            />
          </div>
        </div>

        <div class="mobile-category-select">
          <select (change)="onMobileCategoryChange($event)">
            @for (cat of categories(); track cat.id) {
              <option [value]="cat.id" [selected]="cat.id === activeCategory()">
                {{ cat.name }}
              </option>
            }
          </select>
        </div>

        @for (group of itemsByCategory(); track group.id) {
          @if (group.items.length > 0) {
          <div class="category-section" [id]="'category-' + group.id">
            <h1 class="category-heading">{{ group.name }}</h1>

            <div class="items-grid">
              @for (item of group.items; track item.id) {
                <article class="menu-card" (click)="openItemModal(item)">
                  <div class="card-info">
                    <h3 class="card-name">{{ item.name }}</h3>
                    <p class="card-description">{{ item.description }}</p>
                    <span class="card-price">CA${{ item.price.toFixed(2) }}</span>
                  </div>
                  <div class="card-right">
                    <div class="card-image">
                      <img [src]="item.image_url" [alt]="item.name" loading="lazy" />
                    </div>
                    <button class="add-btn" [attr.aria-label]="'Ajouter ' + item.name">+</button>
                  </div>
                </article>
              } @empty {
                <p class="no-items">Aucun item dans cette catégorie.</p>
              }
            </div>
          </div>
          }
        }
      </section>
    </div>
  }
</main>

<!-- Modal -->
@if (selectedItem()) {
  <div class="modal-overlay" (click)="onOverlayClick($event)">
    <div class="modal">
      <button class="modal-close" (click)="closeModal()">&times;</button>

      <div class="modal-body">
        <div class="modal-image">
          <img [src]="selectedItem()!.image_url" [alt]="selectedItem()!.name" />
        </div>

        <div class="modal-details">
          <h2 class="modal-name">{{ selectedItem()!.name }}</h2>
          <p class="modal-description">{{ selectedItem()!.description }}</p>
        </div>

        <div class="modal-price-box">
          <span class="modal-price-label">À PARTIR DE</span>
          <span class="modal-price">CA${{ selectedItem()!.price.toFixed(2) }}</span>
          <span class="modal-price-note">Le prix peut varier selon les options.</span>
        </div>

        <div class="modal-note-section">
          <label class="modal-note-label">
            Instructions spéciales
            <span class="modal-note-optional">(optionnel)</span>
          </label>
          <textarea
            class="modal-note-input"
            placeholder="Ex: Sans oignon, extra sauce, bien cuit..."
            maxlength="255"
            [value]="modalNote()"
            (input)="onNoteInput($event)"
          ></textarea>
          <span class="modal-note-count">{{ modalNote().length }}/255</span>
        </div>
      </div>

      <div class="modal-footer">
        <div class="modal-quantity">
          <button class="qty-btn" (click)="decrementQuantity()" [disabled]="modalQuantity() <= 1">−</button>
          <span class="qty-value">{{ modalQuantity() }}</span>
          <button class="qty-btn" (click)="incrementQuantity()">+</button>
        </div>
        <button class="modal-add-btn" (click)="addToCart()">
          Ajouter au panier — CA${{ modalTotal().toFixed(2) }}
        </button>
      </div>
    </div>
  </div>
}

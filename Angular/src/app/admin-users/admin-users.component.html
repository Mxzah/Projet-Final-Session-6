<main class="page-admin">
  <div class="outer-container">
    <div class="welcome-header">
      <h2 class="welcome-title">
        {{ ts.t('admin.users.title') }}
        <button mat-mini-fab class="btn-add" [title]="ts.t('admin.users.add')" (click)="openCreate()">
          <mat-icon>add</mat-icon>
        </button>
      </h2>
      <p class="welcome-text">{{ ts.t('admin.users.subtitle') }}</p>
    </div>

    <!-- Filters bar -->
    <div class="filters-bar">
      <mat-form-field appearance="outline" class="filter-field search-field">
        <mat-label>{{ ts.t('admin.users.search') }}</mat-label>
        <input matInput [value]="searchTerm()" (input)="onSearchChange($event)" />
        <mat-icon matPrefix>search</mat-icon>
      </mat-form-field>

      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>{{ ts.t('admin.users.filterStatus') }}</mat-label>
        <mat-select [value]="filterStatus()" (selectionChange)="onFilterStatusChange($event.value)">
          <mat-option value="all">{{ ts.t('admin.users.all') }}</mat-option>
          @for (s of userStatuses; track s) {
            <mat-option [value]="s">{{ getStatusLabel(s) }}</mat-option>
          }
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>{{ ts.t('admin.users.filterType') }}</mat-label>
        <mat-select [value]="filterType()" (selectionChange)="onFilterTypeChange($event.value)">
          <mat-option value="all">{{ ts.t('admin.users.all') }}</mat-option>
          @for (t of userTypes; track t) {
            <mat-option [value]="t">{{ getTypeLabel(t) }}</mat-option>
          }
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>{{ ts.t('admin.users.sort') }}</mat-label>
        <mat-select [value]="sortOrder()" (selectionChange)="onSortChange($event.value)">
          <mat-option value="none">{{ ts.t('admin.users.sortDefault') }}</mat-option>
          <mat-option value="asc">{{ ts.t('admin.users.sortAZ') }}</mat-option>
          <mat-option value="desc">{{ ts.t('admin.users.sortZA') }}</mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <!-- Sort indicator -->
    @if (sortIndicator()) {
      <div class="sort-indicator">{{ sortIndicator() }}</div>
    }

    @if (isLoading()) {
      <div class="loading">
        <mat-spinner diameter="48"></mat-spinner>
      </div>
    }

    @if (!isLoading() && users().length === 0) {
      <div class="empty">{{ ts.t('admin.users.noUsers') }}</div>
    }

    @if (!isLoading() && users().length > 0) {
      <!-- Employees section -->
      @if (employees().length > 0) {
        <div class="section-header">{{ ts.t('admin.users.employeesSection') }}</div>
        <div class="users-list">
          @for (user of employees(); track user.id) {
            <mat-card class="user-card">
              <mat-card-content class="user-body">
                <div class="user-info">
                  <div class="user-name">{{ user.first_name }} {{ user.last_name }}</div>
                  <div class="user-email">{{ user.email }}</div>
                </div>
                <div class="user-badges">
                  <span class="badge badge-type" [attr.data-type]="user.type">{{ getTypeLabel(user.type) }}</span>
                  <span class="badge badge-status" [attr.data-status]="user.status">{{ getStatusLabel(user.status) }}</span>
                </div>
              </mat-card-content>
              <mat-card-actions class="user-actions">
                <button mat-icon-button class="action-btn toggle" [title]="user.status === 'active' ? ts.t('admin.users.block') : ts.t('admin.users.activate')" (click)="toggleStatus(user)">
                  <mat-icon>{{ user.status === 'active' ? 'block' : 'check_circle' }}</mat-icon>
                </button>
                <button mat-icon-button class="action-btn edit" [title]="ts.t('admin.editBtn')" (click)="openEdit(user)">
                  <mat-icon>edit</mat-icon>
                </button>
                <button mat-icon-button class="action-btn delete" [title]="ts.t('admin.deleteBtn')" (click)="confirmDelete(user)">
                  <mat-icon>delete</mat-icon>
                </button>
              </mat-card-actions>
            </mat-card>
          }
        </div>
      }

      <!-- Clients section -->
      @if (clients().length > 0) {
        <div class="section-header">{{ ts.t('admin.users.clientsSection') }}</div>
        <div class="users-list">
          @for (user of clients(); track user.id) {
            <mat-card class="user-card">
              <mat-card-content class="user-body">
                <div class="user-info">
                  <div class="user-name">{{ user.first_name }} {{ user.last_name }}</div>
                  <div class="user-email">{{ user.email }}</div>
                </div>
                <div class="user-badges">
                  <span class="badge badge-type" [attr.data-type]="user.type">{{ getTypeLabel(user.type) }}</span>
                  <span class="badge badge-status" [attr.data-status]="user.status">{{ getStatusLabel(user.status) }}</span>
                </div>
              </mat-card-content>
              <mat-card-actions class="user-actions">
                <button mat-icon-button class="action-btn toggle" [title]="user.status === 'active' ? ts.t('admin.users.block') : ts.t('admin.users.activate')" (click)="toggleStatus(user)">
                  <mat-icon>{{ user.status === 'active' ? 'block' : 'check_circle' }}</mat-icon>
                </button>
                <button mat-icon-button class="action-btn edit" [title]="ts.t('admin.editBtn')" (click)="openEdit(user)">
                  <mat-icon>edit</mat-icon>
                </button>
                <button mat-icon-button class="action-btn delete" [title]="ts.t('admin.deleteBtn')" (click)="confirmDelete(user)">
                  <mat-icon>delete</mat-icon>
                </button>
              </mat-card-actions>
            </mat-card>
          }
        </div>
      }
    }
  </div>
</main>

import{g as v,j as U,k as b}from"./chunk-SS6MEMTN.js";import{B as o,Da as m,R as p,V as l,Z as c,j as g,m as d,n as i,q as a}from"./chunk-RLSS7KTN.js";var S={production:!0,apiUrl:""};var f=class n{constructor(s){this.http=s}apiUrl=S.apiUrl;post(s,e){return this.http.post(`${this.apiUrl}${s}`,e,{withCredentials:!0}).pipe(a(r=>{if(!r.success)throw r;return r}),o(r=>{if("success"in r&&r.success===!1)return i(()=>r);let t=r.error?.errors;return i(()=>({success:!1,data:null,errors:t||["Une erreur est survenue"]}))}))}get(s,e){let r=new U;if(e)for(let t of Object.keys(e))e[t]&&(r=r.set(t,e[t]));return this.http.get(`${this.apiUrl}${s}`,{withCredentials:!0,params:r}).pipe(a(t=>{if(!t.success)throw t;return t}),o(t=>{if("success"in t&&t.success===!1)return i(()=>t);let h=t.error?.errors;return i(()=>({success:!1,data:null,errors:h||["Une erreur est survenue"]}))}))}put(s,e){return this.http.put(`${this.apiUrl}${s}`,e,{withCredentials:!0}).pipe(a(r=>{if(!r.success)throw r;return r}),o(r=>{if("success"in r&&r.success===!1)return i(()=>r);let t=r.error?.errors;return i(()=>({success:!1,data:null,errors:t||["Une erreur est survenue"]}))}))}delete(s){return this.http.delete(`${this.apiUrl}${s}`,{withCredentials:!0}).pipe(a(e=>{if(!e.success)throw e;return e}),o(e=>{if("success"in e&&e.success===!1)return i(()=>e);let r=e.error?.errors;return i(()=>({success:!1,data:null,errors:r||["Une erreur est survenue"]}))}))}static \u0275fac=function(e){return new(e||n)(c(b))};static \u0275prov=l({token:n,factory:n.\u0275fac,providedIn:"root"})};var R=class n{constructor(s,e){this.apiService=s;this.isBrowser=v(e),this.isBrowser&&this.loadUserFromStorage()}currentUser=null;isLoggedInSubject=new g(!1);isLoggedIn$=this.isLoggedInSubject.asObservable();isBrowser;loadUserFromStorage(){if(!this.isBrowser)return;let s=localStorage.getItem("currentUser");s&&(this.currentUser=JSON.parse(s),this.isLoggedInSubject.next(!0))}saveUserToStorage(s){this.isBrowser&&localStorage.setItem("currentUser",JSON.stringify(s))}clearUserFromStorage(){this.isBrowser&&localStorage.removeItem("currentUser")}login(s,e){let r={user:{email:s,password:e}};return this.apiService.post("/users/sign_in",r).pipe(p(t=>{t.success&&t.data&&(this.currentUser=t.data,this.saveUserToStorage(t.data),this.isLoggedInSubject.next(!0))}))}signup(s,e,r,t,h,T){let w={user:{email:s,password:e,password_confirmation:r,first_name:t,last_name:h,type:T}};return this.apiService.post("/users",w).pipe(p(u=>{u.success&&u.data&&(this.currentUser=u.data,this.saveUserToStorage(u.data),this.isLoggedInSubject.next(!0))}))}logout(){return this.apiService.delete("/users/sign_out").pipe(p(()=>{this.currentUser=null,this.clearUserFromStorage(),this.isLoggedInSubject.next(!1)}),o(()=>(this.currentUser=null,this.clearUserFromStorage(),this.isLoggedInSubject.next(!1),d(null))))}isAuthenticated(){return this.isLoggedInSubject.value}isAdmin(){return this.currentUser?.type==="Administrator"}isWaiter(){return this.currentUser?.type==="Waiter"}isCook(){return this.currentUser?.type==="Cook"}isKitchenStaff(){return this.isAdmin()||this.isWaiter()||this.isCook()}getCurrentUser(){return this.currentUser}static \u0275fac=function(e){return new(e||n)(c(f),c(m))};static \u0275prov=l({token:n,factory:n.\u0275fac,providedIn:"root"})};export{f as a,R as b};

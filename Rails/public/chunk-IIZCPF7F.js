import{a as _e,b as ve}from"./chunk-B5HP7SZ3.js";import{a as xe}from"./chunk-SJ24TNRC.js";import{a as Ce}from"./chunk-Z2FRV3RQ.js";import{a as ce,b as le}from"./chunk-I7AMMOYK.js";import{a as se,b as de,c as pe,e as ge,f as be,g as fe}from"./chunk-ZBD6JLV6.js";import{C as K,D as X,G as ee,H as te,b as R,c as v,e as G,f as q,g as B,i as O,k as Z,l as Q,n as U,o as $,q as W,u as Y,v as H,w as J}from"./chunk-HXVBPVRM.js";import{T as ie,U as ne,W as oe,X as ae,Y as re,Z as me,_ as ue}from"./chunk-33DWQQLF.js";import"./chunk-HALU6EK7.js";import{i as V,j}from"./chunk-TJODSPPL.js";import{Bb as A,Cb as I,Db as M,Eb as a,Fb as r,Gb as y,Lb as E,Pb as _,Rb as c,Ua as i,Vb as k,Wb as F,Xb as T,bb as C,bc as z,da as x,dc as m,ea as h,ec as g,fc as b,hb as w,kc as N,lc as D,ma as P,pc as L,qa as f,wb as S,xb as d,yb as p}from"./chunk-QXPTUTPQ.js";var ye=["createAvailList"];function Oe(t,n){if(t&1&&(a(0,"div",7),m(1),r()),t&2){let e=c();i(),g(e.loadError())}}function Pe(t,n){if(t&1&&(a(0,"div",7),m(1),r()),t&2){let e=c();i(),g(e.actionError())}}function we(t,n){t&1&&(a(0,"div",8),y(1,"mat-spinner",12),r())}function Se(t,n){if(t&1&&(a(0,"div",9),m(1),r()),t&2){let e=c();i(),g(e.ts.t("admin.combos.empty"))}}function Ae(t,n){if(t&1&&(a(0,"span",18),m(1),r()),t&2){let e=c(3);i(),g(e.ts.t("admin.unavailable"))}}function Ie(t,n){if(t&1&&(a(0,"mat-card",14)(1,"mat-card-content",15)(2,"div",16)(3,"div",17),m(4),d(5,Ae,2,1,"span",18),r(),a(6,"div",19),m(7),r()(),a(8,"div",20),m(9),N(10,"number"),r()()()),t&2){let e=n.$implicit,o=c(2);z("unavailable",o.unavailableIds().has(e.id)),i(4),b(" ",e.name," "),i(),p(o.unavailableIds().has(e.id)?5:-1),i(2),g(e.description||"\u2014"),i(2),b("",D(10,6,e.price,"1.2-2")," $")}}function Ee(t,n){if(t&1&&(a(0,"div",10),A(1,Ie,11,9,"mat-card",13,S().trackByComboId,!0),r()),t&2){let e=c();i(),I(e.combos())}}function ke(t,n){if(t&1&&m(0),t&2){let e=c(3);b(" ",e.ts.t("admin.nameRequired")," ")}}function Fe(t,n){if(t&1&&m(0),t&2){let e=c(3);b(" ",e.ts.t("admin.combos.nameMaxLength")," ")}}function Te(t,n){if(t&1&&m(0),t&2){let e=c(3);b(" ",e.ts.t("admin.combos.nameWhitespace")," ")}}function ze(t,n){if(t&1&&(a(0,"mat-error"),d(1,ke,1,1)(2,Fe,1,1)(3,Te,1,1),r()),t&2){let e=c(2);i(),p(e.createForm.controls.name.errors.required?1:e.createForm.controls.name.errors.maxlength?2:e.createForm.controls.name.errors.whitespace?3:-1)}}function Ne(t,n){if(t&1&&(a(0,"mat-error"),m(1),r()),t&2){let e=c(2);i(),g(e.ts.t("admin.combos.descMaxLength"))}}function De(t,n){if(t&1&&m(0),t&2){let e=c(3);b(" ",e.ts.t("admin.priceRequired")," ")}}function Le(t,n){if(t&1&&m(0),t&2){let e=c(3);b(" ",e.ts.t("admin.combos.priceMin")," ")}}function Ve(t,n){if(t&1&&(a(0,"mat-error"),d(1,De,1,1)(2,Le,1,1),r()),t&2){let e=c(2);i(),p(e.createForm.controls.price.errors.required?1:e.createForm.controls.price.errors.min?2:-1)}}function je(t,n){if(t&1){let e=E();a(0,"div",11)(1,"mat-card",21)(2,"button",22),_("click",function(){x(e);let l=c();return h(l.cancelCreate())}),a(3,"mat-icon"),m(4,"close"),r()(),a(5,"mat-card-header")(6,"mat-card-title",23),m(7),r()(),a(8,"mat-card-content")(9,"form",24),_("ngSubmit",function(){x(e);let l=c();return h(l.saveCreate())}),a(10,"mat-form-field",25)(11,"mat-label"),m(12),r(),y(13,"input",26),d(14,ze,4,1,"mat-error"),r(),a(15,"mat-form-field",25)(16,"mat-label"),m(17),r(),y(18,"textarea",27),d(19,Ne,2,1,"mat-error"),r(),a(20,"mat-form-field",25)(21,"mat-label"),m(22),r(),y(23,"input",28),d(24,Ve,3,1,"mat-error"),r(),a(25,"app-availability-list",29,0),_("availabilitiesChange",function(l){x(e);let s=c();return h(s.createAvailabilities.set(l))}),r(),a(27,"mat-card-actions",30)(28,"button",31),_("click",function(){x(e);let l=c();return h(l.cancelCreate())}),m(29),r(),a(30,"button",32),m(31),r()()()()()()}if(t&2){let e=c();i(7),g(e.ts.t("admin.combos.createTitle")),i(2),M("formGroup",e.createForm),i(3),g(e.ts.t("admin.name")),i(2),p(e.createForm.controls.name.dirty&&e.createForm.controls.name.errors?14:-1),i(3),g(e.ts.t("admin.description")),i(2),p(e.createForm.controls.description.dirty&&(e.createForm.controls.description.errors!=null&&e.createForm.controls.description.errors.maxlength)?19:-1),i(3),g(e.ts.t("admin.price")),i(2),p(e.createForm.controls.price.dirty&&e.createForm.controls.price.errors?24:-1),i(),M("availabilities",e.createAvailabilities())("disabled",e.isSaving()),i(4),g(e.ts.t("admin.cancel")),i(),M("disabled",e.createForm.invalid||e.isSaving()),i(),b(" ",e.isSaving()?e.ts.t("admin.combos.creating"):e.ts.t("tables.create")," ")}}function Re(t){return t.value&&/^\s*$/.test(t.value)?{whitespace:!0}:null}var he=class t{constructor(n,e,o,l,s){this.combosService=n;this.availabilityService=e;this.errorService=o;this.ngZone=l;this.ts=s;this.ngZone.runOutsideAngular(()=>{this.nowInterval=setInterval(()=>{this.ngZone.run(()=>this.now.set(Date.now()))},6e4)})}createAvailList;combos=f([]);createAvailabilities=f([]);now=f(Date.now());nowInterval;unavailableIds=L(()=>{let n=this.now();return new Set(this.combos().filter(e=>!e.availabilities||e.availabilities.length===0?!0:!e.availabilities.some(o=>{let l=new Date(o.start_at).getTime(),s=o.end_at?new Date(o.end_at).getTime():1/0;return l<=n&&n<s})).map(e=>e.id))});ngOnDestroy(){clearInterval(this.nowInterval)}isLoading=f(!0);loadError=f("");actionError=f("");isCreating=f(!1);isSaving=f(!1);createForm=new B({name:new O("",[v.required,v.maxLength(100),Re]),description:new O("",[v.maxLength(500)]),price:new O(null,[v.required,v.min(.01)])});ngOnInit(){this.loadCombos()}loadCombos(){this.isLoading.set(!0),this.loadError.set(""),this.combosService.getCombos().subscribe({next:n=>{this.combos.set(n),this.isLoading.set(!1)},error:n=>{this.loadError.set(this.errorService.format(this.errorService.fromApiError(n))),this.isLoading.set(!1)}})}openCreate(){this.actionError.set(""),this.isCreating.set(!0),this.createAvailabilities.set([]),this.createForm.reset({name:"",description:"",price:null}),this.createForm.markAsPristine(),this.createForm.markAsUntouched()}cancelCreate(){this.isCreating.set(!1),this.isSaving.set(!1),this.actionError.set(""),this.createAvailabilities.set([])}saveCreate(){if(Object.values(this.createForm.controls).forEach(s=>s.markAsDirty()),this.createForm.invalid||this.isSaving())return;let n=this.createForm.getRawValue(),e=n.name?.trim()??"",o=n.description?.trim()??"",l=Number(n.price);this.actionError.set(""),this.isSaving.set(!0),this.combosService.createCombo({name:e,description:o,price:l}).subscribe({next:s=>{this.combos.update(u=>[s,...u]),this.availabilityService.syncAvailabilities(this.createAvailabilities(),[],u=>this.availabilityService.createAvailability("combos",s.id,u),(u,Me)=>this.availabilityService.updateAvailability("combos",s.id,u,Me),u=>this.availabilityService.deleteAvailability("combos",s.id,u)).subscribe({next:()=>{this.isSaving.set(!1),this.isCreating.set(!1)},error:()=>{this.isSaving.set(!1),this.isCreating.set(!1)}})},error:s=>{this.actionError.set(this.errorService.format(this.errorService.fromApiError(s))),this.isSaving.set(!1)}})}trackByComboId(n,e){return e.id}static \u0275fac=function(e){return new(e||t)(C(xe),C(ve),C(Ce),C(P),C(ue))};static \u0275cmp=w({type:t,selectors:[["app-admin-combos"]],viewQuery:function(e,o){if(e&1&&k(ye,5),e&2){let l;F(l=T())&&(o.createAvailList=l.first)}},decls:16,vars:9,consts:[["createAvailList",""],[1,"page-admin"],[1,"outer-container"],[1,"welcome-header"],[1,"welcome-title"],["mat-mini-fab","",1,"btn-add",3,"click","title"],[1,"welcome-text"],[1,"admin-error"],[1,"loading"],[1,"empty"],[1,"combos-list"],[1,"modal-overlay"],["diameter","48"],[1,"combo-card",3,"unavailable"],[1,"combo-card"],[1,"combo-body"],[1,"combo-main"],[1,"combo-name"],[1,"unavailable-badge"],[1,"combo-description"],[1,"combo-price"],[1,"modal","modal-create"],["mat-icon-button","",1,"modal-close",3,"click"],[1,"modal-title"],[3,"ngSubmit","formGroup"],["appearance","outline",1,"modal-field-full"],["matInput","","formControlName","name"],["matInput","","rows","3","formControlName","description"],["matInput","","type","number","step","0.01","min","0.01","formControlName","price"],[3,"availabilitiesChange","availabilities","disabled"],[1,"modal-actions"],["mat-stroked-button","","type","button",1,"btn-cancel",3,"click"],["mat-flat-button","","type","submit",1,"btn-primary",3,"disabled"]],template:function(e,o){e&1&&(a(0,"main",1)(1,"div",2)(2,"div",3)(3,"h2",4),m(4),a(5,"button",5),_("click",function(){return o.openCreate()}),a(6,"mat-icon"),m(7,"add"),r()()(),a(8,"p",6),m(9),r()(),d(10,Oe,2,1,"div",7),d(11,Pe,2,1,"div",7),d(12,we,2,0,"div",8),d(13,Se,2,1,"div",9),d(14,Ee,3,0,"div",10),r()(),d(15,je,32,13,"div",11)),e&2&&(i(4),b(" ",o.ts.t("admin.combos.title")," "),i(),M("title",o.ts.t("admin.combos.add")),i(4),g(o.ts.t("admin.combos.subtitle")),i(),p(o.loadError()?10:-1),i(),p(o.actionError()?11:-1),i(),p(o.isLoading()?12:-1),i(),p(!o.isLoading()&&o.combos().length===0?13:-1),i(),p(!o.isLoading()&&o.combos().length>0?14:-1),i(),p(o.isCreating()?15:-1))},dependencies:[j,Y,Z,R,Q,G,q,W,$,U,fe,se,ge,pe,be,de,ae,ne,oe,ie,me,re,X,K,H,J,te,ee,le,ce,_e,V],styles:['@import"https://fonts.googleapis.com/css2?family=Fraunces:wght@500;700&family=Space+Grotesk:wght@400;500;600&display=swap";[_nghost-%COMP%]{--ink: #1b1a17;--clay: #f3ede4;--sand: #fbf8f2;--copper: #c86d3f;--rust: #8a3f24;--sage: #7a8f6a;--shadow: 0 25px 60px rgba(27, 26, 23, .18);display:block;min-height:100vh;overflow-x:clip;overflow-y:visible;background:radial-gradient(circle at top left,#f7e6d8,#f9f5ef 45%,#efe7dc);color:var(--ink);font-family:Space Grotesk,Segoe UI,sans-serif}[_nghost-%COMP%]:before, [_nghost-%COMP%]:after{content:"";position:fixed;inset:auto auto 8% -10%;width:320px;height:320px;background:conic-gradient(from 120deg,#c86d3f26,#7a8f6a26);border-radius:50%;filter:blur(10px);z-index:0}[_nghost-%COMP%]:after{inset:-5% -10% auto auto;width:280px;height:280px;background:radial-gradient(circle,rgba(200,109,63,.2),transparent 70%)}.page[_ngcontent-%COMP%]{position:relative;z-index:1;display:grid;grid-template-columns:minmax(280px,560px);justify-content:center;align-items:start;padding:1rem clamp(1rem,3vw,3rem) 1.5rem}.site-header[_ngcontent-%COMP%]{position:relative;z-index:2;display:flex;align-items:center;justify-content:space-between;padding:1rem clamp(1rem,3vw,3rem);background:linear-gradient(120deg,var(--copper),var(--rust));color:#fff}.brand[_ngcontent-%COMP%]{font-weight:600;font-size:1.1rem;letter-spacing:.3rem;text-transform:uppercase;color:#fff}.header-actions[_ngcontent-%COMP%]{display:flex;gap:.75rem}.panel[_ngcontent-%COMP%]{background:var(--sand);border-radius:24px;padding:1.5rem 2rem;box-shadow:var(--shadow);border:1px solid rgba(27,26,23,.08);animation:_ngcontent-%COMP%_float-in .8s ease forwards}.panel__header[_ngcontent-%COMP%]{display:grid;gap:.25rem;margin-bottom:1rem}.eyebrow[_ngcontent-%COMP%]{text-transform:uppercase;letter-spacing:.2rem;font-size:.75rem;color:var(--rust);margin:0}h1[_ngcontent-%COMP%]{font-family:Fraunces,Times New Roman,serif;font-size:clamp(2rem,3vw,2.6rem);margin:0}.subtitle[_ngcontent-%COMP%]{margin:0;color:#1b1a17b3}.form[_ngcontent-%COMP%]{display:grid;gap:.75rem}.field[_ngcontent-%COMP%]{display:grid;gap:.25rem}label[_ngcontent-%COMP%]{font-size:.95rem;font-weight:500}input[_ngcontent-%COMP%]:not([matInput]), select[_ngcontent-%COMP%]{border:1px solid rgba(27,26,23,.2);border-radius:12px;padding:.65rem .875rem;font-size:.95rem;background:#fff;transition:border-color .2s ease,box-shadow .2s ease}input[_ngcontent-%COMP%]:not([matInput]):focus, select[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--copper);box-shadow:0 0 0 3px #c86d3f33}.form__actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:1rem;margin-top:.5rem}button[_ngcontent-%COMP%]{border-radius:999px;padding:.65rem 1.5rem;font-size:.9rem;font-weight:600;cursor:pointer;border:none}.primary[_ngcontent-%COMP%]{background:linear-gradient(120deg,var(--copper),var(--rust));color:#fff;box-shadow:0 12px 25px #8a3f2459}.ghost[_ngcontent-%COMP%]{background:transparent;border:1px solid rgba(27,26,23,.2);color:var(--ink)}.site-header[_ngcontent-%COMP%]   .ghost[_ngcontent-%COMP%]{border-color:#fff6;color:#fff}.site-header[_ngcontent-%COMP%]   .ghost[_ngcontent-%COMP%]:hover{background:#ffffff26}@keyframes _ngcontent-%COMP%_float-in{0%{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}@media(max-width:900px){.page[_ngcontent-%COMP%]{min-height:auto}}@media(max-width:600px){.panel[_ngcontent-%COMP%]{padding:2rem 1.5rem;border-radius:20px}.site-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:1rem}.form__actions[_ngcontent-%COMP%]{flex-direction:column}button[_ngcontent-%COMP%]{width:100%}h1[_ngcontent-%COMP%]{font-size:1.75rem}input[_ngcontent-%COMP%]:not([matInput]), select[_ngcontent-%COMP%]{padding:.75rem .875rem;font-size:.95rem}}@media(max-width:400px){[_nghost-%COMP%]{overflow-x:clip;overflow-y:visible}.page[_ngcontent-%COMP%]{padding:1.5rem 1rem 3rem;grid-template-columns:1fr}.panel[_ngcontent-%COMP%]{padding:1.5rem 1rem;border-radius:16px}.site-header[_ngcontent-%COMP%]{padding:1rem 1rem 0}h1[_ngcontent-%COMP%]{font-size:1.5rem}.subtitle[_ngcontent-%COMP%]{font-size:.9rem}label[_ngcontent-%COMP%]{font-size:.875rem}input[_ngcontent-%COMP%]:not([matInput]), select[_ngcontent-%COMP%]{border-radius:10px;padding:.7rem .75rem;font-size:.9rem}button[_ngcontent-%COMP%]{padding:.7rem 1.2rem;font-size:.9rem}}.page-admin[_ngcontent-%COMP%]{position:relative;z-index:1;display:flex;flex-direction:column;align-items:center;min-height:calc(100vh - 60px);padding:2rem 1rem}.outer-container[_ngcontent-%COMP%]{max-width:760px;width:100%}.welcome-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:1.5rem;position:sticky;top:7.5rem;z-index:30;background:radial-gradient(circle at top left,#f7e6d8,#f9f5ef 45%,#efe7dc);padding:.75rem 0 .5rem}.welcome-title[_ngcontent-%COMP%]{font-family:Fraunces,Times New Roman,serif;font-size:1.5rem;margin:0 0 .5rem;color:var(--rust);display:flex;align-items:center;justify-content:center;gap:.75rem}.welcome-text[_ngcontent-%COMP%]{margin:0;font-size:.9rem;color:#1b1a17b3}.btn-add[_ngcontent-%COMP%]{background:var(--copper)!important;color:#fff!important;width:36px!important;height:36px!important}.combos-list[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:.85rem}.combo-card[_ngcontent-%COMP%]{border:1px solid rgba(27,26,23,.1);border-radius:14px!important;background:var(--sand)!important}.combo-body[_ngcontent-%COMP%]{display:flex!important;justify-content:space-between;align-items:flex-start;gap:1rem;padding:.9rem 1rem!important}.combo-main[_ngcontent-%COMP%]{min-width:0}.combo-name[_ngcontent-%COMP%]{color:var(--ink);font-weight:600;font-size:.95rem;margin-bottom:.3rem}.combo-description[_ngcontent-%COMP%]{color:#1b1a17a6;font-size:.82rem;line-height:1.35}.combo-price[_ngcontent-%COMP%]{color:var(--rust);font-weight:700;font-size:.95rem;white-space:nowrap}.combo-card.unavailable[_ngcontent-%COMP%]{background:#f5f5f5!important;border-color:#1b1a170d!important;opacity:.75}.combo-card.unavailable[_ngcontent-%COMP%]   .combo-name[_ngcontent-%COMP%], .combo-card.unavailable[_ngcontent-%COMP%]   .combo-description[_ngcontent-%COMP%], .combo-card.unavailable[_ngcontent-%COMP%]   .combo-price[_ngcontent-%COMP%]{color:#1b1a1759!important}.unavailable-badge[_ngcontent-%COMP%]{display:inline-block;background:#0000008c;color:#fff;font-size:.65rem;font-weight:600;letter-spacing:.05em;text-transform:uppercase;font-family:Space Grotesk,Segoe UI,sans-serif;border-radius:6px;padding:.15rem .5rem;vertical-align:middle;margin-left:.5rem}.loading[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:3rem}.empty[_ngcontent-%COMP%]{text-align:center;padding:2rem;color:#1b1a1780}.admin-error[_ngcontent-%COMP%]{border:1px solid rgba(220,53,69,.25);color:#a12f3b;background:#fff1f3;border-radius:12px;padding:.65rem .85rem;margin-bottom:.8rem;font-size:.88rem}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#0006;display:flex;align-items:center;justify-content:center;z-index:100}.modal[_ngcontent-%COMP%]{position:relative;background:var(--sand)!important;border-radius:16px!important;width:min(520px,calc(100vw - 2rem));padding:.75rem .75rem .25rem}.modal-close[_ngcontent-%COMP%]{position:absolute;top:.25rem;right:.25rem;color:#1b1a178c!important}.modal-title[_ngcontent-%COMP%]{color:var(--rust)!important;font-family:Fraunces,Times New Roman,serif!important;font-size:1.1rem!important}.modal-field-full[_ngcontent-%COMP%]{width:100%}.modal-actions[_ngcontent-%COMP%]{display:flex!important;justify-content:flex-end;gap:.6rem;margin-top:.4rem!important;padding:0!important}.btn-primary[_ngcontent-%COMP%]{background:var(--copper)!important;color:var(--sand)!important}.btn-cancel[_ngcontent-%COMP%]{color:var(--ink)!important;border-color:#1b1a1740!important}']})};export{he as AdminCombosComponent};

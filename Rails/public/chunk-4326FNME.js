import{a as K}from"./chunk-AO5YKEZX.js";import{a as L}from"./chunk-QS33DWXP.js";import{a as V,c as U,g as $}from"./chunk-NPE3J6VK.js";import{a as H}from"./chunk-W4RF6HJM.js";import{D as T,E as j,H as F,I as N,u as I,w as E,x as k,z}from"./chunk-FLJ6PJLF.js";import{c as G}from"./chunk-3TXLFX2C.js";import{ha as D,ka as B,la as R,ma as A}from"./chunk-D5QILQE7.js";import{a as S}from"./chunk-CDTCJ4FF.js";import{c as O}from"./chunk-PJCREBP6.js";import{i as P}from"./chunk-F3C3U3PJ.js";import{b as w}from"./chunk-67GKTUIW.js";import"./chunk-ZIWWK3EM.js";import{Db as C,Eb as i,Fb as n,Lb as b,Pb as x,Rb as p,Ua as r,bb as m,da as _,dc as a,ea as v,ec as d,fc as l,gc as M,hb as h,qa as g,xb as f,yb as u}from"./chunk-AI52TPR3.js";function q(s,o){if(s&1&&(i(0,"div",20)(1,"span"),a(2),n(),i(3,"strong",21),a(4),n()(),i(5,"div",22)(6,"span"),a(7),n(),i(8,"strong",23),a(9),n()()),s&2){let e=p(),t=p();r(2),M("",t.ts.t("pay.discount")," (",e.discount_percentage,"%)"),r(2),l("-CA$",e.discount_amount.toFixed(2)),r(3),d(t.ts.t("pay.adjustedTotal")),r(2),l("CA$",e.adjusted_total.toFixed(2))}}function J(s,o){if(s&1&&(i(0,"mat-error"),a(1),n()),s&2){let e=p(2);r(),d(e.tipError())}}function Q(s,o){if(s&1){let e=b();i(0,"mat-card",2)(1,"mat-card-content",4)(2,"div",5)(3,"mat-icon",6),a(4,"receipt_long"),n(),i(5,"h1",7),a(6),n(),i(7,"p",8),a(8),n()(),i(9,"div",9)(10,"div",10)(11,"span"),a(12),n(),i(13,"strong"),a(14),n()(),i(15,"div",10)(16,"span"),a(17),n(),i(18,"strong"),a(19),n()(),i(20,"div",11)(21,"span"),a(22),n(),i(23,"strong",12),a(24),n()(),f(25,q,10,5),n(),i(26,"div",13)(27,"mat-form-field",14)(28,"mat-label"),a(29),n(),i(30,"input",15),x("input",function(c){_(e);let y=p();return v(y.onTipChange(c))}),n(),i(31,"mat-icon",16),a(32,"volunteer_activism"),n(),f(33,J,2,1,"mat-error"),n()(),i(34,"div",17)(35,"span"),a(36),n(),i(37,"strong",18),a(38),n()(),i(39,"button",19),x("click",function(){_(e);let c=p();return v(c.onPay())}),i(40,"mat-icon"),a(41,"payment"),n(),a(42),n()()()}if(s&2){let e=o,t=p();r(6),d(t.ts.t("pay.title")),r(2),d(t.ts.t("pay.subtitle")),r(4),d(t.ts.t("pay.table")),r(2),l("#",e.table_number),r(3),d(t.ts.t("pay.items")),r(2),d(e.order_lines.length),r(3),d(t.ts.t("pay.total")),r(2),l("CA$",e.total.toFixed(2)),r(),u(e.discount_percentage>0?25:-1),r(4),d(t.ts.t("pay.tipLabel")),r(),C("value",t.tip()),r(3),u(t.tipError()?33:-1),r(3),d(t.ts.t("pay.grandTotal")),r(2),l("CA$",((e.discount_percentage>0?e.adjusted_total:e.total)+t.tip()).toFixed(2)),r(),C("disabled",t.isPaying()||t.tipError()!==""),r(3),l(" ",t.isPaying()?t.ts.t("pay.processing"):t.ts.t("pay.confirm")," ")}}function W(s,o){if(s&1&&(i(0,"div",3)(1,"p"),a(2),n()()),s&2){let e=p();r(2),d(e.ts.t("pay.loading"))}}var Y=class s{constructor(o,e,t,c,y,X){this.ts=o;this.authService=e;this.orderService=t;this.cartService=c;this.router=y;this.snackBar=X}order=g(null);tip=g(0);tipError=g("");isPaying=g(!1);ngOnInit(){this.loadOrder()}loadOrder(){this.orderService.getOrders().subscribe({next:o=>{let t=(o.data||[]).find(c=>!c.ended_at)||null;if(!t){this.router.navigate(["/order"]);return}this.order.set(t)},error:()=>{this.router.navigate(["/order"])}})}validateTip(){let o=this.tip();return o<0?(this.tipError.set(this.ts.t("pay.tipNegative")),!1):o>999.99?(this.tipError.set(this.ts.t("pay.tipMax")),!1):(this.tipError.set(""),!0)}onTipChange(o){let e=o.target,t=parseFloat(e.value)||0;this.tip.set(t),this.validateTip()}onPay(){if(!this.validateTip()||this.isPaying())return;let o=this.order();o&&(this.isPaying.set(!0),this.orderService.payOrder(o.id,this.tip()).subscribe({next:e=>{if(e.success)this.cartService.clear(),this.authService.logout().subscribe({next:()=>this.router.navigate(["/login"]),error:()=>{localStorage.removeItem("currentUser"),this.router.navigate(["/login"])}});else{let t=e.errors?.join(", ")||this.ts.t("pay.error");this.snackBar.open(t,"OK",{duration:5e3}),this.isPaying.set(!1)}},error:()=>{this.snackBar.open(this.ts.t("pay.error"),"OK",{duration:5e3}),this.isPaying.set(!1)}}))}logout(){this.cartService.clear(),this.authService.logout().subscribe({next:o=>{o?.success&&this.router.navigate(["/login"])},error:()=>{localStorage.removeItem("currentUser"),this.router.navigate(["/login"])}})}static \u0275fac=function(e){return new(e||s)(m(w),m(S),m(H),m(L),m(O),m(K))};static \u0275cmp=h({type:s,selectors:[["app-pay"]],decls:4,vars:1,consts:[[3,"logoutClick"],[1,"pay-page"],["appearance","outlined",1,"pay-card"],[1,"loading"],[1,"pay-content"],[1,"pay-header"],[1,"pay-icon"],[1,"pay-title"],[1,"pay-subtitle"],[1,"pay-summary"],[1,"summary-line"],[1,"summary-line","total-line"],[1,"total-price"],[1,"tip-section"],["appearance","outline",1,"tip-field"],["matInput","","type","number","min","0","max","999.99","step","0.50","placeholder","0.00",3,"input","value"],["matPrefix",""],[1,"grand-total"],[1,"grand-total-price"],["mat-raised-button","","color","primary",1,"pay-btn",3,"click","disabled"],[1,"summary-line","discount-line"],[1,"discount-price"],[1,"summary-line","adjusted-total-line"],[1,"adjusted-total-price"]],template:function(e,t){if(e&1&&(i(0,"app-header",0),x("logoutClick",function(){return t.logout()}),n(),i(1,"main",1),f(2,Q,43,16,"mat-card",2)(3,W,3,1,"div",3),n()),e&2){let c;r(2),u((c=t.order())?2:3,c)}},dependencies:[P,I,G,B,D,$,V,U,A,R,j,T,E,k,z,N,F],styles:['@import"https://fonts.googleapis.com/css2?family=Fraunces:wght@500;700&family=Space+Grotesk:wght@400;500;600&display=swap";[_nghost-%COMP%]{--ink: #1b1a17;--clay: #f3ede4;--sand: #fbf8f2;--copper: #c86d3f;--rust: #8a3f24;--sage: #7a8f6a;--shadow: 0 25px 60px rgba(27, 26, 23, .18);display:block;min-height:100vh;overflow-x:clip;overflow-y:visible;background:radial-gradient(circle at top left,#f7e6d8,#f9f5ef 45%,#efe7dc);color:var(--ink);font-family:Space Grotesk,Segoe UI,sans-serif}[_nghost-%COMP%]:before, [_nghost-%COMP%]:after{content:"";position:fixed;inset:auto auto 8% -10%;width:320px;height:320px;background:conic-gradient(from 120deg,#c86d3f26,#7a8f6a26);border-radius:50%;filter:blur(10px);z-index:0}[_nghost-%COMP%]:after{inset:-5% -10% auto auto;width:280px;height:280px;background:radial-gradient(circle,rgba(200,109,63,.2),transparent 70%)}.page[_ngcontent-%COMP%]{position:relative;z-index:1;display:grid;grid-template-columns:minmax(280px,560px);justify-content:center;align-items:start;padding:1rem clamp(1rem,3vw,3rem) 1.5rem}.site-header[_ngcontent-%COMP%]{position:relative;z-index:2;display:flex;align-items:center;justify-content:space-between;padding:1rem clamp(1rem,3vw,3rem);background:linear-gradient(120deg,var(--copper),var(--rust));color:#fff}.brand[_ngcontent-%COMP%]{font-weight:600;font-size:1.1rem;letter-spacing:.3rem;text-transform:uppercase;color:#fff}.header-actions[_ngcontent-%COMP%]{display:flex;gap:.75rem}.panel[_ngcontent-%COMP%]{background:var(--sand);border-radius:24px;padding:1.5rem 2rem;box-shadow:var(--shadow);border:1px solid rgba(27,26,23,.08);animation:_ngcontent-%COMP%_float-in .8s ease forwards}.panel__header[_ngcontent-%COMP%]{display:grid;gap:.25rem;margin-bottom:1rem}.eyebrow[_ngcontent-%COMP%]{text-transform:uppercase;letter-spacing:.2rem;font-size:.75rem;color:var(--rust);margin:0}h1[_ngcontent-%COMP%]{font-family:Fraunces,Times New Roman,serif;font-size:clamp(2rem,3vw,2.6rem);margin:0}.subtitle[_ngcontent-%COMP%]{margin:0;color:#1b1a17b3}.form[_ngcontent-%COMP%]{display:grid;gap:.75rem}.field[_ngcontent-%COMP%]{display:grid;gap:.25rem}label[_ngcontent-%COMP%]{font-size:.95rem;font-weight:500}input[_ngcontent-%COMP%]:not([matInput]), select[_ngcontent-%COMP%]{border:1px solid rgba(27,26,23,.2);border-radius:12px;padding:.65rem .875rem;font-size:.95rem;background:#fff;transition:border-color .2s ease,box-shadow .2s ease}input[_ngcontent-%COMP%]:not([matInput]):focus, select[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--copper);box-shadow:0 0 0 3px #c86d3f33}.form__actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:1rem;margin-top:.5rem}button[_ngcontent-%COMP%]{border-radius:999px;padding:.65rem 1.5rem;font-size:.9rem;font-weight:600;cursor:pointer;border:none}.primary[_ngcontent-%COMP%]{background:linear-gradient(120deg,var(--copper),var(--rust));color:#fff;box-shadow:0 12px 25px #8a3f2459}.ghost[_ngcontent-%COMP%]{background:transparent;border:1px solid rgba(27,26,23,.2);color:var(--ink)}.site-header[_ngcontent-%COMP%]   .ghost[_ngcontent-%COMP%]{border-color:#fff6;color:#fff}.site-header[_ngcontent-%COMP%]   .ghost[_ngcontent-%COMP%]:hover{background:#ffffff26}@keyframes _ngcontent-%COMP%_float-in{0%{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}@media(max-width:900px){.page[_ngcontent-%COMP%]{min-height:auto}}@media(max-width:600px){.panel[_ngcontent-%COMP%]{padding:2rem 1.5rem;border-radius:20px}.site-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:1rem}.form__actions[_ngcontent-%COMP%]{flex-direction:column}button[_ngcontent-%COMP%]{width:100%}h1[_ngcontent-%COMP%]{font-size:1.75rem}input[_ngcontent-%COMP%]:not([matInput]), select[_ngcontent-%COMP%]{padding:.75rem .875rem;font-size:.95rem}}@media(max-width:400px){[_nghost-%COMP%]{overflow-x:clip;overflow-y:visible}.page[_ngcontent-%COMP%]{padding:1.5rem 1rem 3rem;grid-template-columns:1fr}.panel[_ngcontent-%COMP%]{padding:1.5rem 1rem;border-radius:16px}.site-header[_ngcontent-%COMP%]{padding:1rem 1rem 0}h1[_ngcontent-%COMP%]{font-size:1.5rem}.subtitle[_ngcontent-%COMP%]{font-size:.9rem}label[_ngcontent-%COMP%]{font-size:.875rem}input[_ngcontent-%COMP%]:not([matInput]), select[_ngcontent-%COMP%]{border-radius:10px;padding:.7rem .75rem;font-size:.9rem}button[_ngcontent-%COMP%]{padding:.7rem 1.2rem;font-size:.9rem}}.pay-page[_ngcontent-%COMP%]{padding:1.5rem clamp(1rem,3vw,3rem) 2.5rem;min-height:calc(100vh - 60px);max-width:480px;margin:0 auto;display:flex;align-items:flex-start;justify-content:center}.pay-card[_ngcontent-%COMP%]{width:100%;border-radius:16px!important;overflow:hidden}.pay-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem;padding:2rem 1.5rem!important}.pay-header[_ngcontent-%COMP%]{text-align:center}.pay-icon[_ngcontent-%COMP%]{font-size:2.5rem;width:2.5rem;height:2.5rem;color:var(--copper);margin-bottom:.5rem}.pay-title[_ngcontent-%COMP%]{font-family:Fraunces,Times New Roman,serif;font-size:clamp(1.4rem,2.5vw,1.8rem);margin:0 0 .25rem;color:var(--ink)}.pay-subtitle[_ngcontent-%COMP%]{font-size:.9rem;color:#1b1a178c;margin:0}.pay-summary[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.6rem;padding:1rem;background:#1b1a1708;border-radius:12px}.summary-line[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;font-size:.95rem;color:var(--ink)}.total-line[_ngcontent-%COMP%]{border-top:1px solid rgba(27,26,23,.1);padding-top:.6rem;margin-top:.25rem}.total-price[_ngcontent-%COMP%]{font-family:Fraunces,Times New Roman,serif;font-size:1.3rem;font-weight:700;color:var(--copper)}.discount-line[_ngcontent-%COMP%]{color:#2e7d32}.discount-price[_ngcontent-%COMP%]{color:#2e7d32;font-weight:600}.adjusted-total-line[_ngcontent-%COMP%]{border-top:1px solid rgba(27,26,23,.1);padding-top:.6rem;margin-top:.25rem}.adjusted-total-price[_ngcontent-%COMP%]{font-family:Fraunces,Times New Roman,serif;font-size:1.3rem;font-weight:700;color:#2e7d32}.tip-section[_ngcontent-%COMP%]{display:flex;flex-direction:column}.tip-field[_ngcontent-%COMP%]{width:100%}.grand-total[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem;background:#c86d3f14;border-radius:12px;font-size:1.05rem;font-weight:600;color:var(--ink)}.grand-total-price[_ngcontent-%COMP%]{font-family:Fraunces,Times New Roman,serif;font-size:1.5rem;font-weight:700;color:var(--copper)}.pay-btn[_ngcontent-%COMP%]{width:100%;padding:.85rem 1.5rem!important;font-size:1.05rem!important;border-radius:12px!important;font-family:Space Grotesk,Segoe UI,sans-serif!important}button[mat-raised-button].mat-primary[_ngcontent-%COMP%], button[mat-raised-button][color=primary][_ngcontent-%COMP%]{background:linear-gradient(120deg,var(--copper),var(--rust))!important;color:#fff!important}.loading[_ngcontent-%COMP%]{text-align:center;color:#1b1a1780;padding:3rem 0}@media(max-width:600px){.pay-page[_ngcontent-%COMP%]{padding:1rem}.pay-content[_ngcontent-%COMP%]{padding:1.25rem 1rem!important}}']})};export{Y as PayComponent};
